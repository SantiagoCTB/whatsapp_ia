{% extends 'base.html' %}
{% block title %}Botones{% endblock %}
{% block body_class %}page{% endblock %}
{% block content %}
<div class="top-right">
    <a href="{{ url_for('chat.index') }}">
        <button class="back-btn btn-primary">Volver al inicio</button>
    </a>
</div>

<h2>Botones rápidos para el chat</h2>

<form method="POST" enctype="multipart/form-data">
    <label for="nombre">Nombre del botón:</label>
    <input type="text" name="nombre" id="nombre">

    <label for="mensaje">Nuevo mensaje:</label>
    <textarea name="mensaje" rows="3" required></textarea>

    <label for="tipo">Tipo de medio:</label>
    <select name="tipo" id="tipo">
        <option value="texto">Texto</option>
        <option value="image">Imagen</option>
        <option value="video">Video</option>
        <option value="audio">Audio</option>
        <option value="document">PDF</option>
    </select>

    <label for="media" id="label_media_file" style="display:none;">Subir archivo:</label>
    <input type="file" id="media" name="media[]" multiple style="display:none;">

    <label for="media_url" id="label_media_url" style="display:none;">URLs de archivos (separadas por comas o saltos de línea):</label>
    <textarea id="media_url" name="media_url" style="display:none;" placeholder="URL1, URL2&#10;URL3"></textarea>

    <button type="submit" class="btn-primary">Agregar botón</button>
</form>

<form method="POST" enctype="multipart/form-data">
    <label for="archivo">Importar botones desde Excel:</label>
    <input type="file" name="archivo" accept=".xlsx" required>
    <button type="submit" class="btn-primary">Importar</button>
</form>

<h3>Botones actuales</h3>
<table class="fixed-table">
    <tr><th>ID</th><th>Nombre</th><th>Mensaje</th><th>URLs</th><th>Acción</th></tr>
    {% for b in botones %}
    <tr>
        <td>{{ b[0] }}</td>
        <td>{{ b[3]|default('') }}</td>
        <td style="white-space: pre-line;">{{ b[1] }}</td>
        <td style="word-break: break-all;">{{ b[4]|default('')|replace('||', '<br>')|safe }}</td>
        <td>
            <form method="POST" action="{{ url_for('configuracion.eliminar_boton', boton_id=b[0]) }}">
                <button class="delete-btn btn-primary" type="submit">Eliminar</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<script>
function toggleMediaFields() {
    const tipo = document.getElementById('tipo').value;
    const show = ['image', 'video', 'audio', 'document'].includes(tipo);
    const mediaInput = document.getElementById('media');
    const mediaUrl   = document.getElementById('media_url');
    mediaInput.style.display = show ? 'block' : 'none';
    document.getElementById('label_media_file').style.display = show ? 'block' : 'none';
    mediaUrl.style.display = show ? 'block' : 'none';
    document.getElementById('label_media_url').style.display = show ? 'block' : 'none';
    if (!show) {
        mediaInput.value = '';
        mediaUrl.value = '';
    }
}

document.getElementById('tipo').addEventListener('change', toggleMediaFields);
window.addEventListener('DOMContentLoaded', toggleMediaFields);
</script>
{% endblock %}
